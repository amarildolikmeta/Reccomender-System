{"version":"NotebookV1","origId":726631496901654,"name":"Machine Learning","language":"python","commands":[{"version":"CommandV1","origId":726631496901656,"guid":"2380bb60-2580-4be2-9d5f-4ab7b2b0fdbc","subtype":"command","commandType":"auto","position":1.0,"command":"numberOfItemsToRecommend=5\nn=numberOfItemsToRecommend","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540728163,"submitTime":1497540643944,"finishTime":1497540728321,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7285b1de-2c34-46b4-9435-8ba8d6c87706"},{"version":"CommandV1","origId":726631496901657,"guid":"a25cb141-b917-4552-a717-27ab2b74b25a","subtype":"command","commandType":"auto","position":2.0,"command":"train=sqlContext.sql(\"SELECT * from train\")\ntrainRDD=train.rdd.map(lambda x:(int(x[0]),int(x[1]),int(x[2])))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540728456,"submitTime":1497540643949,"finishTime":1497540730475,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0c6c2dfb-49b9-456e-a686-8295a124e7f4"},{"version":"CommandV1","origId":726631496901658,"guid":"30c57dee-36bb-4c3c-945f-6d228a360054","subtype":"command","commandType":"auto","position":3.0,"command":"testRDD=sqlContext.sql(\"Select * from target\").rdd.map(lambda x:int(x[0]))\ntestList=testRDD.sortBy(lambda x:float(x))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540730483,"submitTime":1497540643954,"finishTime":1497540730806,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0b00e94d-02be-4ca2-95a1-587a9c2ca639"},{"version":"CommandV1","origId":726631496901659,"guid":"5aa13628-6b60-4029-8952-433105858ebd","subtype":"command","commandType":"auto","position":4.0,"command":"URM_train, URM_test = trainRDD.randomSplit([0.6, 0.4])\n\nURM_tuple = None\n\nprint(\"Train tuples {}, test tuples {}\".format(URM_train.count(), URM_test.count()))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Train tuples 101714, test tuples 68435\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540730813,"submitTime":1497540643976,"finishTime":1497540735745,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"50eb9c10-b0c0-4195-867c-03c40a2b3821"},{"version":"CommandV1","origId":726631496901660,"guid":"42a1fb85-d07a-4faa-8d81-f634d68ffd7b","subtype":"command","commandType":"auto","position":5.0,"command":"from pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\n\nURM_train_rating = URM_train.map(lambda x: Rating(int(x[0]),int(x[1]),float(x[2])))\n\nURM_train_rating.take(10)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">5</span><span class=\"ansired\">]: </span>\n[Rating(user=2738, product=1, rating=1.0),\n Rating(user=15122, product=1, rating=4.0),\n Rating(user=11326, product=2, rating=5.0),\n Rating(user=3406, product=3, rating=4.0),\n Rating(user=3906, product=3, rating=10.0),\n Rating(user=6345, product=3, rating=6.0),\n Rating(user=7393, product=3, rating=8.0),\n Rating(user=815, product=4, rating=8.0),\n Rating(user=1544, product=4, rating=6.0),\n Rating(user=1871, product=4, rating=4.0)]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540735754,"submitTime":1497540643981,"finishTime":1497540735978,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"99c884c9-9320-4307-9e36-a281359ae766"},{"version":"CommandV1","origId":726631496901661,"guid":"6117714f-2b30-4c77-b200-a03b29743ac6","subtype":"command","commandType":"auto","position":6.0,"command":"import numpy as np\n\ndef MAP(RankedList, PositiveItems, at=numberOfItemsToRecommend):\n    \"\"\"\n    Calculates MAP@__ \n    \"\"\"\n    \n    RankedList = RankedList[:at]\n    is_relevant = np.in1d(RankedList, PositiveItems, assume_unique=True)\n    \n    p_at_k = is_relevant * np.cumsum(is_relevant, dtype=np.float32) / (1 + np.arange(len(is_relevant)))\n    map_score = np.sum(p_at_k) / np.min([len(PositiveItems), len(RankedList)])\n    \n    assert 0 <= map_score <= 1, map_score\n    \n    return map_score","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540735985,"submitTime":1497540643986,"finishTime":1497540736011,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1c56dde2-9f6a-4c3b-8bac-6ca3eb94ab38"},{"version":"CommandV1","origId":726631496901662,"guid":"d1862cad-c405-4b6d-bb6b-3183a38d86e7","subtype":"command","commandType":"auto","position":7.0,"command":"def recommendWithALS(user_id,model=modelFull, n=5):\n    \n    singleUserRecommendation = model.recommendProducts(user_id, n)\n    itemsToRecommend = []\n    \n    for ratingTuple in singleUserRecommendation:\n        itemsToRecommend.append(ratingTuple.product)\n        \n    return itemsToRecommend","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540770291,"submitTime":1497540643997,"finishTime":1497540770336,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"776f980b-9273-4d35-b9d5-b9f0dc1b8b58"},{"version":"CommandV1","origId":726631496901663,"guid":"2400b1fd-c417-4d95-ad2e-a2211c8b11d1","subtype":"command","commandType":"auto","position":8.0,"command":"user_id = 5\n\nrecommendWithALS( user_id,model, 5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">11</span><span class=\"ansired\">]: </span>[3100, 17856, 7562, 22762, 13726]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540800994,"submitTime":1497540644014,"finishTime":1497540801219,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d5044642-2f1a-4495-841d-ccabe2888ea1"},{"version":"CommandV1","origId":726631496901664,"guid":"11f37fbd-2a46-4abe-9ada-584e39380aa7","subtype":"command","commandType":"auto","position":9.0,"command":"MAP(recommendWithALS( user_id,model, 5), userPositiveItems_dict[user_id], at=5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">12</span><span class=\"ansired\">]: </span>0.0\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540801231,"submitTime":1497540644020,"finishTime":1497540801406,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"91ceb190-58ad-425b-9434-6c39924b1ce5"},{"version":"CommandV1","origId":726631496901667,"guid":"62231aaf-6a6d-4b2f-b8b5-5ec11171b7c3","subtype":"command","commandType":"auto","position":7.75,"command":"model = ALS.train(URM_train_rating, rank, numIterations)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540775376,"submitTime":1497540644008,"finishTime":1497540800983,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a3436662-803a-4738-9689-7cfccea2f4c3"},{"version":"CommandV1","origId":726631496901668,"guid":"baad1cad-0eb7-4183-887a-5d5b0e7cbe1e","subtype":"command","commandType":"auto","position":10.0,"command":"def calculateOverallMap(model, userList, userPositiveItems_dict, at=5):\n    \n    MAP_value = 0.0\n    \n    for user_id in userList:\n      try :    \n         MAP_value += MAP(recommendWithALS(user_id,model, at), userPositiveItems_dict[user_id], at=at)\n      except :\n         MAP_value+=0\n    MAP_value = MAP_value/len(userList)\n    \n    return MAP_value\n    ","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540801414,"submitTime":1497540644026,"finishTime":1497540801486,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4bf9d94c-bb7d-492c-928a-81a6fc79756f"},{"version":"CommandV1","origId":726631496901669,"guid":"79de8e2f-77b1-4c78-a49d-f9ec168ab728","subtype":"command","commandType":"auto","position":3.5,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2df5bcf2-177d-4a7e-bff2-f8362ccdf46e"},{"version":"CommandV1","origId":726631496901670,"guid":"e6279782-e702-4ad4-8f31-2c401a3fe2b2","subtype":"command","commandType":"auto","position":7.125,"command":"userPositiveItems_dict = URM_test.map(lambda x: (int(x[0]), [x[1]])).reduceByKey(lambda x,y : x + y).collectAsMap()\nuserSeenItems_dict = URM_train.map(lambda x: (int(x[0]), [x[1]])).reduceByKey(lambda x,y : x + y).collectAsMap()\n\nuser_id = 15\nprint(\"User {} has {} positive items, some of them are: {}\".\n      format(user_id, len(userPositiveItems_dict[user_id]), userPositiveItems_dict[user_id][0:10]))\nprint(\"User {} has {} seen items, some of them are: {}\".\n      format(user_id, len(userSeenItems_dict[user_id]), userSeenItems_dict[user_id][0:10]))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">User 15 has 3 positive items, some of them are: [1686, 4949, 13298]\nUser 15 has 2 seen items, some of them are: [25363, 33993]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540770342,"submitTime":1497540644002,"finishTime":1497540775369,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a66e7bb4-a286-4f01-a444-02ed1a4bb17c"},{"version":"CommandV1","origId":726631496901671,"guid":"5115a834-2b52-4752-9d5f-8bc1182fbd60","subtype":"command","commandType":"auto","position":11.0,"command":"userList_test = URM_test.map(lambda x: int(x[0])).distinct().collect()\nuserList_train = URM_train.map(lambda x: int(x[0])).distinct().collect()\n\nstart_time = time.time()\n\ntestMAP = calculateOverallMap(model, userList_test, userPositiveItems_dict)\n\nprint(\"MAP value is {:.4f}. Processing required {:.2f} seconds\".format(\\\n    testMAP, time.time()-start_time))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">MAP value is 0.0012. Processing required 728.24 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540801536,"submitTime":1497540644036,"finishTime":1497541533921,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"51facbb0-5260-4a77-ab0b-450ef48bd2f6"},{"version":"CommandV1","origId":726631496901673,"guid":"bf25c899-eb20-4b3a-98c1-fdf9d013666c","subtype":"command","commandType":"auto","position":10.5,"command":"import time","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540801492,"submitTime":1497540644031,"finishTime":1497540801531,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0d92352b-d75d-4c0d-8c8e-9a972373d190"},{"version":"CommandV1","origId":726631496901674,"guid":"36b44669-c339-4b39-ad7e-0945dfece039","subtype":"command","commandType":"auto","position":13.0,"command":"from sklearn.linear_model import ElasticNet\nimport scipy.sparse as sps\nimport numpy as np","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1497549669023,"submitTime":1497540644047,"finishTime":1497549669509,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d0e27f69-3e50-4c2b-852d-4e59ee85a0dc"},{"version":"CommandV1","origId":726631496901675,"guid":"af611796-b265-43f8-8e5f-999134dd5a85","subtype":"command","commandType":"auto","position":6.5,"command":"URM_full_rating=trainRDD.map(lambda x: Rating(int(x[0]),int(x[1]),float(x[2])))\nrank = 40\nnumIterations = 20\nmodelFull = ALS.train(URM_full_rating, rank, numIterations)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Internal error, sorry. Attach your notebook to a different cluster or restart the current cluster.","error":null,"workflows":[],"startTime":1497540736018,"submitTime":1497540643991,"finishTime":1497540770280,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"87b5507b-bd6b-4584-a0b8-ef35ebf52110"},{"version":"CommandV1","origId":726631496901676,"guid":"d0afda05-6157-48f0-aed3-bed50b19660a","subtype":"command","commandType":"auto","position":14.0,"command":"rows =    [1, 1, 2, 2, 2, 3]\ncolumns = [1, 2, 2, 3, 1, 2]\ndata =    [5, 5, 6, 6, 7, 7]\n\nexampleCSCmatrix = sps.csc_matrix((data, (rows, columns)))\n\nexampleCSCmatrix.todense()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">18</span><span class=\"ansired\">]: </span>\nmatrix([[0, 0, 0, 0],\n        [0, 5, 5, 0],\n        [0, 7, 6, 6],\n        [0, 0, 7, 0]])\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1497549669512,"submitTime":1497540644052,"finishTime":1497549669551,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cee0e933-1df7-45f3-8913-57ffe4285127"},{"version":"CommandV1","origId":726631496901677,"guid":"df43738c-7f1e-40aa-b99d-0be4d026bd19","subtype":"command","commandType":"auto","position":15.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aa8bd868-35da-46c8-9815-197118330877"},{"version":"CommandV1","origId":3454502863129714,"guid":"b32a85c3-b371-4a78-a09c-c9f4363e78d6","subtype":"command","commandType":"auto","position":12.0,"command":"import itertools\n\nrankList = [ 500,100]\n#numIterations = [5, 10, 15, 20]\nnumIterations = [50,60]\n\ntest_case_list = itertools.product(rankList, numIterations)\ntest_case_results = []\n\nfor test_case in test_case_list:\n    \n    rank = test_case[0]\n    numIterations = test_case[1]\n    \n    start_time = time.time()   \n    model = ALS.train(URM_train_rating, rank, numIterations)\n    train_time = time.time()-start_time\n    \n    #trainMAP = calculateOverallMap(model, userList_train, userSeenItems_dict)\n    testMAP = calculateOverallMap(model, userList_train, userPositiveItems_dict)\n    \n    print(\"Rank {}, Iterations {} - testMAP {:.4f},  training time {:.2f} sec\".\n          format(rank, numIterations, testMAP,  train_time))\n    \n    test_case_results.append((rank, numIterations, testMAP, train_time))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Rank 500, Iterations 50 - testMAP 0.0014,  training time 9218.81 sec\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1497554900343,"submitTime":1497554900343,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"amarildolikmeta@gmail.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f2f9be1b-dbcd-4385-aab9-a532674db8a1"},{"version":"CommandV1","origId":3454502863129717,"guid":"3916c633-88a4-41b2-b502-f595c17b5b27","subtype":"command","commandType":"auto","position":12.5,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a1d62478-f298-4b70-9748-858f86b6f33d"}],"dashboards":[],"guid":"857539ff-3b2b-4ab9-b388-3418e8884135","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}